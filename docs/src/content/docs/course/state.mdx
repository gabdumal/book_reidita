---
title: Estado
author: Gabriel Malosto
---

import { Aside } from "@astrojs/starlight/components";
import Figure from "/src/components/Figure.astro";

import actions from "/src/assets/content/docs/course/state/actions.png";
import trades from "/src/assets/content/docs/course/state/trades.png";
import newResources from "/src/assets/content/docs/course/state/new_resources.png";

Agora que temos os bot√µes, precisamos implementar suas a√ß√µes.
A l√≥gica de coletar madeira √© simples: ao clicar no bot√£o, a quantidade de madeira deve aumentar.
Conclu√≠mos que deve haver uma vari√°vel para armazenar a quantidade de madeira.

A implementa√ß√£o trivial seria criar uma vari√°vel global para armazenar a quantidade de madeira.
No entanto, isso n√£o √© uma boa pr√°tica, pois vari√°veis globais podem causar problemas de manuten√ß√£o e escalabilidade.

Al√©m disso, podemos melhorar essa ideia ao n√£o somente armazenar a quantidade, mas tamb√©m representar cada recurso como um objeto.

## Tipos

Quando trabalhamos com objetos no TypeScript, √© uma boa pr√°tica antes definir uma interface que represente a forma do objeto.
Uma vez que esses tipos ser√£o usados por todo o projeto, √© melhor defini-los em um arquivo separado.

### Recurso

1. Crie um arquivo chamado `types.ts` na pasta `src`.
2. Adicione as seguintes interfaces ao arquivo:

```tsx
/* types.ts */

export interface Resource {
  name: string;
  icon: string;
  amount: number;
}

export interface Resources {
  wood: Resource;
  coin: Resource;
}
```

3. Edite o componente `ResourceDisplay` para que ele receba um objeto do tipo `Resource`. Lembre-se de importar a interface `Resource` no in√≠cio do arquivo.

```tsx
/* ResourceDisplay.tsx */

interface ResourceDisplayProps {
  resource: Resource;
}
```

4. Atualize os props recebidos pela fun√ß√£o que define o componente. Tamb√©m atualize o conte√∫do dos elementos `<h1>` e `<span>` para exibir o nome, o √≠cone e a quantidade do recurso.

```tsx
/* ResourceDisplay.tsx */

export default function ResourceDisplay({
  resource,
  amount,
}: ResourceDisplayProps) {
  return (
    <div className={styles.box}>
      <h1 className={styles.name}>{resource.name}</h1>
      <span className={styles.icon}>{resource.icon}</span>
      <p className={styles.amount}>{resource.amount}</p>
    </div>
  );
}
```

5. Dentro da **fun√ß√£o** que define o componente `ResourcesContainer`, crie um objeto do tipo `Resource` para representar a madeira e outro para representar as moedas.

```tsx
/* ResourcesContainer.tsx */

export default function ResourcesContainer() {
  const wood: Resource = {
    name: "Madeira",
    icon: "üå≥",
    amount: 0,
  };

  const coin: Resource = {
    name: "Moeda",
    icon: "ü™ô",
    amount: 0,
  };

  // ...
}
```

6. Logo abaixo, crie um objeto do tipo `Resources` que inclua a madeira e as moedas.

```tsx
/* ResourcesContainer.tsx */

const resources: Resources = {
  wood,
  coin,
};
```

7. Atualize as chamadas do componente `ResourceDisplay` para que elas passem o recurso.

```tsx
/* ResourcesContainer.tsx */

return (
  <section className={styles.container}>
    <div className={styles.group}>
      <ResourceDisplay resource={resources.wood} />
      <ResourceDisplay resource={resources.coin} />
    </div>
  </section>
);
```

A p√°gina deve continuar exibindo os recursos da mesma forma que antes.
Apenas mudamos a forma como os recursos s√£o representados no c√≥digo.

### A√ß√£o

Vamos atualizar a representa√ß√£o das a√ß√µes da mesma forma que fizemos com os recursos.
Uma a√ß√£o √© um objeto que cont√©m um nome e rela√ß√µes entre recursos.
Por exemplo, uma a√ß√£o de vender madeira remove uma certa quantidade de madeira do estoque e adiciona uma certa quantidade de moedas.
Por isso, vamos criar dois tipos: troca e a√ß√£o.

1. Adicione as seguintes interfaces ao arquivo `types.ts`:

```tsx
/* types.ts */

export interface Trade {
  resource: Resource;
  quantity: number;
}

export interface Action {
  name: string;
  icon: string;
  trades: Trade[];
}

export interface Actions {
  chopWood: Action;
  sellWood: Action;
}
```

2. Edite o componente `ActionButton` para que ele receba um objeto do tipo `Action`.

```tsx
/* ActionButton.tsx */

interface ActionButtonProps {
  action: Action;
}
```

3. Atualize os props recebidos pela fun√ß√£o que define o componente. Tamb√©m atualize o conte√∫do dos elementos `<p>` e `<span>` para exibir o nome e o √≠cone da a√ß√£o, respectivamente.

```tsx
/* ActionButton.tsx */

export default function ActionButton({ action }: ActionButtonProps) {
  return (
    <div className={styles.box}>
      <p className={styles.name}>{action.name}</p>
      <button className={styles.button}>
        <span className={styles.icon}>{action.icon}</span>
      </button>
    </div>
  );
}
```

4. Dentro da **fun√ß√£o** que define o componente `ActionsContainer`, crie um objeto do tipo `Action` para representar as a√ß√µes de cortar madeira e vender madeira. Tamb√©m crie um objeto do tipo `Actions` que inclua essas a√ß√µes.

```tsx
/* ActionsContainer.tsx */

export default function ActionsContainer() {
  const chopWood: Action = {
    name: "Cortar Madeira",
    icon: "ü™ì",
    trades: [],
  };

  const sellWood: Action = {
    name: "Vender Madeira",
    icon: "üí∞",
    trades: [],
  };

  const actions: Actions = {
    chopWood,
    sellWood,
  };

  // ...
}
```

5. Atualize as chamadas do componente `ActionButton` para que elas passem as a√ß√µes.

```tsx
/* ActionsContainer.tsx */

return (
  <section className={styles.container}>
    <div className={styles.group}>
      <ActionButton action={actions.chopWood} />
      <ActionButton action={actions.sellWood} />
    </div>
  </section>
);
```

O resultado final deve ser como o seguinte:

<Figure
  caption={`Recursos "Madeira" e "Moeda", e bot√µes de a√ß√£o para cortar madeira e vender madeira.`}
  images={[
    {
      src: actions,
      alt: `P√°gina do projeto mostrando os recursos "Madeira" e "Moeda", e bot√µes de a√ß√£o para cortar e vender madeira, cada um com seu nome e √≠cone.`,
    },
  ]}
/>

## Eleva√ß√£o de estado

Voc√™ pode ter percebido que n√£o preenchemos o vetor de trocas das a√ß√µes.
Isso ocorre porque, para faz√™-lo, √© necess√°rio receber a lista de todos os recursos dispon√≠veis.
Entretanto, os recursos s√£o definidos no componente `ResourcesContainer`, e as a√ß√µes s√£o definidas no componente `ActionsContainer`, que s√£o irm√£os na hierarquia de componentes.
Em situa√ß√µes como essa, devemos **elevar o estado** para o componente pai em comum.

1. Remova a defini√ß√£o do objeto `resources` do componente `ResourcesContainer` e o mova para o componente `App`.

```tsx
/* App.tsx */

export default function App() {
  const wood: Resource = {
    name: "Madeira",
    icon: "üå≥",
    amount: 0,
  };

  const coin: Resource = {
    name: "Moeda",
    icon: "ü™ô",
    amount: 0,
  };

  const resources: Resources = {
    wood,
    coin,
  };

  // ...
}
```

2. Passe o objeto `resources` como propriedade para os componentes `ResourcesContainer` e `ActionsContainer`.

```tsx
/* App.tsx */

return (
  <article className={styles.container}>
    <Header />
    <ResourcesContainer resources={resources} />
    <ActionsContainer resources={resources} />
  </article>
);
```

3. Receba o objeto `resources` como propriedade no componente `ResourcesContainer`.

```tsx
/* ResourcesContainer.tsx */

interface ResourcesContainerProps {
  resources: Resources;
}

export default function ResourcesContainer({
  resources,
}: ResourcesContainerProps) {
  // ...
}
```

4. Receba o objeto `resources` como propriedade no componente `ActionsContainer`.

```tsx
/* ActionsContainer.tsx */

interface ActionsContainerProps {
  resources: Resources;
}

export default function ActionsContainer({ resources }: ActionsContainerProps) {
  // ...
}
```

5. Atualize as propriedades `trades` das a√ß√µes para que elas recebam a lista de recursos dispon√≠veis.

```tsx
/* ActionsContainer.tsx */

const chopWood: Action = {
  name: "Cortar Madeira",
  icon: "ü™ì",
  trades: [{ resource: resources.wood, quantity: +1 }],
};

const sellWood: Action = {
  name: "Vender Madeira",
  icon: "üí∞",
  trades: [
    { resource: resources.wood, quantity: -1 },
    { resource: resources.coin, quantity: +1 },
  ],
};
```

## Hook useState

Precisamos de alguma forma de atualizar o valor dos recursos quando uma a√ß√£o √© executada.
Como fazer isso se os recursos s√£o definidos no componente `App` e o bot√£o est√° no componente `ActionButton`?

O React fornece um **hook** chamado `useState` que permite adicionar estado a um componente funcional.
Ele permite que, ao atualizar o estado, o componente seja renderizado novamente para refletir as mudan√ßas.

<Aside type="note">
  Um **hook** √© uma fun√ß√£o especial que implementa diferentes funcionalidades do
  React em componentes funcionais.
</Aside>

1. Importe o hook `useState` do React no arquivo `App.tsx`.

```tsx
/* App.tsx */

import { useState } from "react";
```

2. Apague as defini√ß√µes dos objetos `resource` e `resources`. Ent√£o use o hook `useState` para criar um estado que armazena os dados definidos anteriormente.

```tsx
/* App.tsx */

export default function App() {
  const [resources, setResources] = useState<Resources>({
    wood: {
      name: "Madeira",
      icon: "üå≥",
      amount: 0,
    },
    coin: {
      name: "Moeda",
      icon: "ü™ô",
      amount: 0,
    },
  });

  // ...
}
```

<Aside type="note">
  O hook `useState` retorna um array com dois elementos. O primeiro √© o estado
  atual, que √© inicializado com o valor passado como argumento. O segundo √© uma
  fun√ß√£o que atualiza o estado, a qual pode ser chamada para inserir um novo
  valor.
</Aside>

3. Passe a fun√ß√£o `setResources` como propriedade para o componente `ActionsContainer`.

```tsx
/* App.tsx */

<ActionsContainer resources={resources} setResources={setResources} />
```

4. Receba a fun√ß√£o `setResources` como propriedade no componente `ActionsContainer`.

```tsx
/* ActionsContainer.tsx */

interface ActionsContainerProps {
  resources: Resources;
  setResources: React.Dispatch<React.SetStateAction<Resources>>;
}
```

5. Atualize a fun√ß√£o que define o componente `ActionsContainer` para que ela receba a fun√ß√£o `setResources`.

```tsx
export default function ActionsContainer({
  resources,
  setResources,
}: ActionsContainerProps) {
  // ...
}
```

6. Passe a fun√ß√£o `setResources` como propriedade para os componentes `ActionButton`.

```tsx
/* ActionsContainer.tsx */

<ActionButton action={actions.chopWood} setResources={setResources} />
<ActionButton action={actions.sellWood} setResources={setResources} />
```

7. Receba a fun√ß√£o `setResources` como propriedade no componente `ActionButton`.

```tsx
/* ActionButton.tsx */

interface ActionButtonProps {
  action: Action;
  setResources: React.Dispatch<React.SetStateAction<Resources>>;
}
```

8. Atualize os props recebidos pela fun√ß√£o que define o componente `ActionButton`.

```tsx
/* ActionButton.tsx */

export default function ActionButton({
  action,
  setResources,
}: ActionButtonProps) {
  // ...
}
```

## Atualizando os recursos

Vamos atualizar a fun√ß√£o `performTrade` no componente `ActionButton` para que ela calcule as trocas e atualize o estado dos recursos.

1.  Inicialize uma vari√°vel para determinar se √© poss√≠vel executar todas as trocas necess√°rias para a a√ß√£o.

```tsx
/* ActionButton.tsx */

const performTrade = () => {
  let tradeIsPossible = true;

  // ...
};
```

2.  Itere sobre as trocas necess√°rias para a a√ß√£o, recebendo pelos par√¢metros o recurso e a quantidade a ser alterada. Podemos utilizar a sintaxe de desestrutura√ß√£o para acess√°-los.

```tsx
/* ActionButton.tsx */

action.trades.forEach(({ resource, quantity }) => {
  // ...
});
```

<Aside type="note">
  O m√©todo `forEach` √© utilizado para iterar sobre os elementos de um vetor. Ele
  recebe uma fun√ß√£o de *callback* nos par√¢metros, a qual executa sobre cada
  elemento do vetor. Como somos n√≥s quem est√° chamando o m√©todo, podemos definir
  o corpo da fun√ß√£o de *callback*. Ela pode receber pelos par√¢metros: o elemento
  atual, o √≠ndice do elemento e o vetor completo.
</Aside>

3.  Dentro do `forEach`, calcule o novo valor do recurso e verifique se a troca √© poss√≠vel.

```tsx
/* ActionButton.tsx */

const newAmount = resource.amount + quantity;
tradeIsPossible = tradeIsPossible && newAmount >= 0;
```

4.  Dentro do `forEach`, caso a troca seja poss√≠vel, atualize o valor do recurso.

```tsx
/* ActionButton.tsx */

if (tradeIsPossible) resource.amount = newAmount;
```

5.  Ap√≥s o `forEach`, verifique se todas as trocas foram poss√≠veis e, caso positivo, atualize o estado dos recursos.

```tsx
/* ActionButton.tsx */

if (tradeIsPossible) setResources(resources => ({ ...resources }));
```

<Aside type="note">
  A fun√ß√£o `setResources` recebe uma fun√ß√£o de *callback* que retorna o novo
  estado. Ela passa como par√¢metro o valor do estado antes de fazermos a
  atualiza√ß√£o. Ent√£o, utilizamos o operador de
  [**espalhamento**](https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/Spread_syntax)
  (`...`) para copiar todos os recursos atualizados para o estado existente.
</Aside>

O c√≥digo final da fun√ß√£o `performTrade` deve ser igual ao seguinte:

```tsx
/* ActionButton.tsx */

const performTrade = () => {
  let tradeIsPossible = true;

  action.trades.forEach(({ resource, quantity }) => {
    const newAmount = resource.amount + quantity;
    tradeIsPossible = tradeIsPossible && newAmount >= 0;

    if (tradeIsPossible) resource.amount = newAmount;
  });

  if (tradeIsPossible) setResources(resources => ({ ...resources }));
};
```

Ao clicar no bot√£o de cortar madeira, a quantidade de madeira deve aumentar em uma unidade.
J√° ao clicar no bot√£o de vender madeira, a quantidade de madeira deve diminuir em uma unidade e a quantidade de moedas deve aumentar em uma unidade.

## Criando novos recursos e a√ß√µes

Agora que temos um sistema de recursos e a√ß√µes flex√≠vel, podemos adicionar novos recursos e a√ß√µes facilmente.
Por√©m, antes disso, precisamos ajustar um detalhe.
O jogador n√£o tem como saber quais s√£o as quantidades envolvidas nas trocas!

### Lista de trocas

Para resolver isso, vamos editar o componente `ActionButton` para exibir as quantidades de troca.
Ap√≥s o elemento `<button>`, crie um elemento de lista n√£o ordenada [`<ul>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ul).

```tsx
/* ActionButton.tsx */

<ul className={styles.trades}>
  {action.trades.map(({ resource, quantity }) => (
    <li key={resource.name}>
      {quantity > 0 ? "+" : ""}
      {quantity} {resource.icon} {resource.name}
    </li>
  ))}
</ul>
```

O resultado final deve ser como o seguinte:

<Figure
  caption="Bot√µes de a√ß√£o para cortar madeira e vender madeira."
  images={[
    {
      src: trades,
      alt: `P√°gina do projeto mostrando os bot√µes de a√ß√£o para cortar e vender madeira, cada um com seu nome, √≠cone e trocas associadas. A troca de cortar madeira √© de +1 üå≥ Madeira, e a troca de vender madeira √© de -1 üå≥ Madeira e +1 ü™ô Moeda.`,
    },
  ]}
/>

### Recursos

Agora, vamos adicionar dois novos recursos: casa e trabalhador.
A casa custa madeira e moedas.
J√° o trabalhador precisa do sal√°rio pago em moedas e de uma casa para morar.

1. Edite o tipo `Resources` no arquivo `types.ts` para incluir os novos recursos.

```tsx
/* types.ts */

export interface Resources {
  wood: Resource;
  coin: Resource;
  house: Resource;
  worker: Resource;
}
```

2. Adicione os objetos `house` e `worker` ao estado inicial de recursos no componente `App`.

```tsx
/* App.tsx */

const [resources, setResources] = useState<Resources>({
  wood: {
    name: "Madeira",
    icon: "üå≥",
    amount: 0,
  },
  coin: {
    name: "Moeda",
    icon: "ü™ô",
    amount: 0,
  },
  house: {
    name: "Casa",
    icon: "üè†",
    amount: 0,
  },
  worker: {
    name: "Trabalhador",
    icon: "üë∑",
    amount: 0,
  },
});
```

3. Edite o componente `ResourcesContainer` para exibir os novos recursos dinamicamente.

```tsx
/* ResourcesContainer.tsx */

return (
  <section className={styles.container}>
    <div className={styles.group}>
      {Object.values(resources).map(resource => (
        <ResourceDisplay key={resource.name} resource={resource} />
      ))}
    </div>
  </section>
);
```

O resultado final deve ser como o seguinte:

<Figure
  caption="Recursos Madeira, Moeda, Casa e Trabalhador."
  images={[
    {
      src: newResources,
      alt: `P√°gina do projeto mostrando os recursos "Madeira", "Moeda", "Casa" e "Trabalhador", cada um com seu nome, √≠cone e quantidade. Abaixo, h√° bot√µes de a√ß√£o para cortar e vender madeira.`,
    },
  ]}
/>
