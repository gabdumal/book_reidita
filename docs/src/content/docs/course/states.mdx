---
title: Estados
author: Gabriel Malosto
---

import { Aside } from "@astrojs/starlight/components";
import Figure from "/src/components/Figure.astro";

import actions from "/src/assets/content/docs/course/states/actions.png";
import trades from "/src/assets/content/docs/course/states/trades.png";
import newResources from "/src/assets/content/docs/course/states/new_resources.png";
import newActions from "/src/assets/content/docs/course/states/new_actions.png";

Agora que temos os bot√µes, precisamos implementar suas a√ß√µes.
A l√≥gica de coletar madeira √© simples: ao clicar no bot√£o, a quantidade de madeira deve aumentar.
Conclu√≠mos que deve haver uma vari√°vel para armazenar a quantidade de madeira.

A implementa√ß√£o trivial seria criar uma vari√°vel global para armazenar a quantidade de madeira.
No entanto, isso n√£o √© uma boa pr√°tica, pois vari√°veis globais podem causar problemas de manuten√ß√£o e escalabilidade.

Al√©m disso, podemos melhorar essa ideia ao n√£o somente armazenar a quantidade, mas tamb√©m representar cada recurso como um objeto.

## Tipos

Quando trabalhamos com objetos no TypeScript, √© uma boa pr√°tica antes definir uma interface que represente a forma do objeto.
Uma vez que esses tipos ser√£o usados por todo o projeto, √© melhor defini-los em um arquivo separado.

### Recurso

1. Crie um arquivo chamado `types.ts` na pasta `src`.

2. Adicione a seguinte enumera√ß√£o ao arquivo:

```ts
/* types.ts */

export enum ResourceType {
  wood = "wood",
  coin = "coin",
}
```

<Aside type="note">
  Uma [**enumera√ß√£o**](https://www.typescriptlang.org/docs/handbook/enums.html)
  √© um tipo de dados que consiste em um conjunto de valores nomeados. Cada valor
  √© associado a um n√∫mero inteiro ou a uma string.
</Aside>

3. Adicione as seguinte interface ao arquivo:

```ts
/* types.ts */

export interface Resource {
  name: string;
  icon: string;
  amount: number;
}
```

4. Defina o tipo para representar um conjunto de recursos.

```ts
/* types.ts */

export type Resources = { [Property in keyof typeof ResourceType]: Resource };
```

5. Edite o componente `ResourceDisplay` para que ele receba um objeto do tipo `Resource`. Lembre-se de importar a interface `Resource` no in√≠cio do arquivo.

```tsx
/* ResourceDisplay.tsx */

interface ResourceDisplayProps {
  resource: Resource;
}

export default function ResourceDisplay({ resource }: ResourceDisplayProps) {
  // ...
}
```

6. Atualize o conte√∫do dos elementos `<h1>` e `<span>` para exibir o nome, o √≠cone e a quantidade do recurso.

```tsx
/* ResourceDisplay.tsx */

export default function ResourceDisplay({ resource }: ResourceDisplayProps) {
  return (
    <div className={styles.box}>
      <h1 className={styles.name}>{resource.name}</h1>
      <span className={styles.icon}>{resource.icon}</span>
      <p className={styles.amount}>{resource.amount}</p>
    </div>
  );
}
```

7. Dentro da **fun√ß√£o** que define o componente `ResourcesContainer`, **crie** um objeto do tipo `Resources` para representar a madeira e as moedas.

```tsx
/* ResourcesContainer.tsx */

export default function ResourcesContainer() {
  const resources: Resources = {
    wood: {
      name: "Madeira",
      icon: "üå≥",
      amount: 0,
    },
    coin: {
      name: "Moeda",
      icon: "ü™ô",
      amount: 0,
    },
  };

  return(
    // ...
  );
}
```

8. Atualize as chamadas do componente `ResourceDisplay` para que elas passem o recurso.

```tsx
/* ResourcesContainer.tsx */

return (
  <section className={styles.container}>
    <div className={styles.group}>
      <ResourceDisplay resource={resources.wood} />
      <ResourceDisplay resource={resources.coin} />
    </div>
  </section>
);
```

A p√°gina deve continuar exibindo os recursos da mesma forma que antes.
Apenas mudamos a forma como os recursos s√£o representados no c√≥digo.

### A√ß√£o

Vamos atualizar a representa√ß√£o das a√ß√µes da mesma forma que fizemos com os recursos.
Uma a√ß√£o √© um objeto que cont√©m um nome e rela√ß√µes entre recursos.
Por exemplo, uma a√ß√£o de vender madeira remove uma certa quantidade de madeira do estoque e adiciona uma certa quantidade de moedas.
Por isso, vamos criar dois tipos: troca e a√ß√£o.

1. Adicione a interface `Trade` ao arquivo `types.ts` para representar uma troca.

```ts
/* types.ts */

export interface Trade {
  resourceType: ResourceType;
  amount: number;
}
```

2. Adicione a seguinte enumera√ß√£o ao arquivo:

```ts
/* types.ts */

export enum ActionType {
  chopWood = "chopWood",
  sellWood = "sellWood",
}
```

3. Adicione a interface `Action` ao arquivo `types.ts` para representar uma a√ß√£o.

```ts
/* types.ts */

export interface Action {
  name: string;
  icon: string;
  trades: Trade[];
}
```

4. Defina o tipo `Actions` para representar um conjunto de a√ß√µes.

```ts
/* types.ts */

export type Actions = { [Property in keyof typeof ActionType]: Action };
```

5. Edite o componente `ActionButton` para que ele receba um objeto do tipo `Action`.

```tsx
/* ActionButton.tsx */

interface ActionButtonProps {
  action: Action;
}

export default function ActionButton({ action }: ActionButtonProps) {
  // ...
}
```

6. Atualize o conte√∫do dos elementos `<p>` e `<span>` para exibir o nome e o √≠cone da a√ß√£o, respectivamente.

```tsx
/* ActionButton.tsx */

export default function ActionButton({ action }: ActionButtonProps) {
  return (
    <div className={styles.box}>
      <p className={styles.name}>{action.name}</p>
      <button className={styles.button}>
        <span className={styles.icon}>{action.icon}</span>
      </button>
    </div>
  );
}
```

7. Dentro da **fun√ß√£o** que define o componente `ActionsContainer`, crie um objeto do tipo `Actions` para representar as a√ß√µes de cortar madeira e vender madeira.

```tsx
/* ActionsContainer.tsx */

export default function ActionsContainer() {
  const actions: Actions = {
    chopWood: {
      name: "Cortar Madeira",
      icon: "ü™ì",
      trades: [{ resourceType: ResourceType.wood, amount: +1 }],
    },
    sellWood: {
      name: "Vender Madeira",
      icon: "üí∞",
      trades: [
        { resourceType: ResourceType.wood, amount: -1 },
        { resourceType: ResourceType.coin, amount: +1 },
      ],
    },
  };

  // ...
}
```

8. Atualize as chamadas do componente `ActionButton` para que elas passem as a√ß√µes.

```tsx
/* ActionsContainer.tsx */

return (
  <section className={styles.container}>
    <div className={styles.group}>
      <ActionButton action={actions.chopWood} />
      <ActionButton action={actions.sellWood} />
    </div>
  </section>
);
```

O resultado final deve ser como o seguinte:

<Figure
  caption={`Recursos "Madeira" e "Moeda", e bot√µes de a√ß√£o para cortar madeira e vender madeira.`}
  images={[
    {
      src: actions,
      alt: `P√°gina do projeto mostrando os recursos "Madeira" e "Moeda", e bot√µes de a√ß√£o para cortar e vender madeira, cada um com seu nome e √≠cone.`,
    },
  ]}
/>

## Eleva√ß√£o de estado

Para que possamos atualizar a quantidade de recursos ao clicar nos bot√µes de a√ß√£o, precisamos de uma forma de acessar e modificar o estado dos recursos.
Entretanto, esses s√£o definidos no componente `ResourcesContainer`, e as a√ß√µes s√£o definidas no componente `ActionsContainer`, que s√£o irm√£os na hierarquia de componentes.
Em situa√ß√µes como essa, devemos **elevar o estado** para o componente pai em comum.

1. Mova a defini√ß√£o do objeto `resources` do componente `ResourcesContainer` para o componente `App`.

```tsx
/* App.tsx */

export default function App() {
  const resources: Resources = {
    wood: {
      name: "Madeira",
      icon: "üå≥",
      amount: 0,
    },
    coin: {
      name: "Moeda",
      icon: "ü™ô",
      amount: 0,
    },
  };

  // ...
}
```

2. Passe o objeto `resources` como propriedade para o componente `ResourcesContainer`.

```tsx
/* App.tsx */

return (
  <article className={styles.container}>
    <Header />
    <ResourcesContainer resources={resources} />
    <ActionsContainer />
  </article>
);
```

3. Receba o objeto `resources` como propriedade no componente `ResourcesContainer`.

```tsx
/* ResourcesContainer.tsx */

interface ResourcesContainerProps {
  resources: Resources;
}

export default function ResourcesContainer({
  resources,
}: ResourcesContainerProps) {
  // ...
}
```

## Hook useState

Precisamos de alguma forma de atualizar o valor dos recursos quando uma a√ß√£o √© executada.
Como fazer isso se os recursos s√£o definidos no componente `App` e o bot√£o est√° no componente `ActionButton`?

O React fornece um **hook** chamado `useState` que permite adicionar estado a um componente funcional.
Ele permite que, ao atualizar o estado, o componente seja renderizado novamente para refletir as mudan√ßas.

<Aside type="note">
  Um [**hook**](https://pt-br.react.dev/reference/react/hooks) √© uma fun√ß√£o
  especial que implementa diferentes funcionalidades do React em componentes
  funcionais.
</Aside>

1. Importe o hook `useState` do React no arquivo `App.tsx`.

```tsx
/* App.tsx */

import { useState } from "react";
```

2. Use o hook `useState` para criar um estado que armazena os dados definidos anteriormente no objeto `resources`.

```tsx
/* App.tsx */

export default function App() {
  const [resources, setResources] = useState<Resources>({
    wood: {
      name: "Madeira",
      icon: "üå≥",
      amount: 0,
    },
    coin: {
      name: "Moeda",
      icon: "ü™ô",
      amount: 0,
    },
  });

  // ...
}
```

<Aside type="note">
  O hook [**useState**](https://pt-br.react.dev/reference/react/useState)
  retorna um array com dois elementos. O primeiro √© o estado atual, que √©
  inicializado com o valor passado como argumento. O segundo √© uma fun√ß√£o que
  atualiza o estado, a qual pode ser chamada para inserir um novo valor.
</Aside>

3. Passe o objeto `resources` e a fun√ß√£o `setResources` como propriedades para o componente `ActionsContainer`.

```tsx
/* App.tsx */

<ActionsContainer resources={resources} setResources={setResources} />
```

4. Receba o objeto `resources` e a fun√ß√£o `setResources` como propriedades no componente `ActionsContainer`.

```tsx
/* ActionsContainer.tsx */

interface ActionsContainerProps {
  resources: Resources;
  setResources: React.Dispatch<React.SetStateAction<Resources>>;
}
```

5. Atualize a fun√ß√£o que define o componente `ActionsContainer` para que ela receba o objeto `resources` e a fun√ß√£o `setResources`.

```tsx
export default function ActionsContainer({
  resources,
  setResources,
}: ActionsContainerProps) {
  // ...
}
```

6. Passe o objeto `resources` e a fun√ß√£o `setResources` como propriedades para os componentes `ActionButton`.

```tsx
/* ActionsContainer.tsx */

<ActionButton
  action={actions.chopWood}
  resources={resources}
  setResources={setResources}
/>
<ActionButton
  action={actions.sellWood}
  resources={resources}
  setResources={setResources}
/>
```

7. Receba o objeto `resources` e a fun√ß√£o `setResources` como propriedades no componente `ActionButton`.

```tsx
/* ActionButton.tsx */

interface ActionButtonProps {
  action: Action;
  resources: Resources;
  setResources: React.Dispatch<React.SetStateAction<Resources>>;
}
```

8. Atualize os props recebidos pela fun√ß√£o que define o componente `ActionButton`.

```tsx
/* ActionButton.tsx */

export default function ActionButton({
  action,
  resources,
  setResources,
}: ActionButtonProps) {
  // ...
}
```

## Atualizando os recursos

Vamos atualizar a fun√ß√£o `performTrade` no componente `ActionButton` para que ela calcule as trocas e atualize o estado dos recursos.

1.  Inicialize uma vari√°vel para determinar se √© poss√≠vel executar todas as trocas necess√°rias para a a√ß√£o. Tamb√©m crie uma c√≥pia do objeto `resources` por meio do operador de espalhamento (`...`).

```tsx
/* ActionButton.tsx */

const performTrade = () => {
  let tradeIsPossible = true;
  const updatedResources = { ...resources };

  // Vamos colocar a pr√≥xima instru√ß√£o aqui...
};
```

<Aside type="note">
  Utilizamos o operador de
  [**espalhamento**](https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/Spread_syntax)
  (`...`) para copiar todos os recursos do estado atual para um tempor√°rio.
</Aside>

2.  Dentro da fun√ß√£o `performTrade`, itere sobre as trocas necess√°rias para a a√ß√£o, recebendo pelos par√¢metros o recurso e a quantidade a ser alterada. Podemos utilizar a sintaxe de desestrutura√ß√£o para acess√°-los.

```tsx
/* ActionButton.tsx */

// Definimos as duas vari√°veis aqui em cima...

action.trades.forEach(({ resourceType, amount }) => {
  // Vamos colocar a pr√≥xima instru√ß√£o aqui...
});
```

<Aside type="note">
  O m√©todo `forEach` √© utilizado para iterar sobre os elementos de um vetor. Ele
  recebe uma fun√ß√£o de *callback* nos par√¢metros, a qual executa sobre cada
  elemento do vetor. Como somos n√≥s quem est√° chamando o m√©todo, podemos definir
  o corpo da fun√ß√£o de *callback*. Ela pode receber pelos par√¢metros: o elemento
  atual, o √≠ndice do elemento e o vetor completo.
</Aside>

3.  Dentro do m√©todo `forEach`, obtenha uma c√≥pia do objeto `resource` a partir da sua chave.

```tsx
/* ActionButton.tsx */

// Estamos dentro do m√©todo forEach...

const resource = { ...updatedResources[resourceType] };
```

4. Ainda dentro do m√©todo `forEach`, calcule o novo valor do recurso e verifique se a troca √© poss√≠vel.

```tsx
/* ActionButton.tsx */

// Estamos dentro do m√©todo forEach...

const newAmount = resource.amount + amount;
tradeIsPossible = tradeIsPossible && newAmount >= 0;
```

5.  Dentro do m√©todo `forEach`, defina o novo valor para a quantidade do recurso. Ent√£o, reencaixe o objeto no `updatedResources`.

```tsx
/* ActionButton.tsx */

// Estamos dentro do m√©todo forEach...

resource.amount = newAmount;
updatedResources[resourceType] = resource;
```

6.  **Ap√≥s** o m√©todo `forEach`, verifique se todas as trocas foram poss√≠veis e, caso positivo, atualize o estado dos recursos.

```tsx
/* ActionButton.tsx */

action.trades.forEach(({ resourceType, amount }) => {
  // Aqui dentro est√° todo o c√≥digo que acabamos de escrever...
});

if (tradeIsPossible) setResources(updatedResources);
```

7. Adicione um atributo `onClick` ao bot√£o que chama a fun√ß√£o `performTrade`.

```tsx
/* ActionButton.tsx */

<button className={styles.button} onClick={performTrade}>
  <span className={styles.icon}>{action.icon}</span>
</button>
```

O c√≥digo final da fun√ß√£o `performTrade` deve ser igual ao seguinte:

```tsx
/* ActionButton.tsx */

const performTrade = () => {
  let tradeIsPossible = true;
  const updatedResources = { ...resources };

  action.trades.forEach(({ resourceType, amount }) => {
    const resource = { ...updatedResources[resourceType] };
    const newAmount = resource.amount + amount;
    tradeIsPossible = tradeIsPossible && newAmount >= 0;

    resource.amount = newAmount;
    updatedResources[resourceType] = resource;
  });

  if (tradeIsPossible) setResources(updatedResources);
};
```

Ao clicar no bot√£o de cortar madeira, a quantidade de madeira deve aumentar em uma unidade.
J√° ao clicar no bot√£o de vender madeira, a quantidade de madeira deve diminuir em uma unidade e a quantidade de moedas deve aumentar em uma unidade.

## Criando novos recursos e a√ß√µes

Agora que temos um sistema de recursos e a√ß√µes flex√≠vel, podemos adicionar novos recursos e a√ß√µes facilmente.
Por√©m, antes disso, precisamos ajustar um detalhe.
O jogador n√£o tem como saber quais s√£o as quantidades envolvidas nas trocas!

### Lista de trocas

Para resolver isso, vamos editar o componente `ActionButton` para exibir as quantidades de troca.

1. Antes da keyword `return`, crie um objeto `listItems`, que mapeia cada troca para um elemento de item de lista [`<li>`](https://developer.mozilla.org/pt-BR/docs/Web/HTML/Element/li).

```tsx
/* ActionButton.tsx */

const listItems = action.trades.map(({ resourceType, amount }) => {
  const resource = resources[resourceType];
  return (
    <li key={resource.name}>
      {amount > 0 ? "+" : ""}
      {amount} {resource.icon} {resource.name}
    </li>
  );
});
```

2. Depois do elemento `<button>`, adicione um elemento de lista n√£o ordenada [`<ul>`](https://developer.mozilla.org/pt-BR/docs/Web/HTML/Element/ul). Dentro dele, adicione o objeto `listItems`.

```tsx
/* ActionButton.tsx */

<ul className={styles.trades}>{listItems}</ul>
```

O resultado final deve ser como o seguinte:

<Figure
  caption="Bot√µes de a√ß√£o para cortar madeira e vender madeira."
  images={[
    {
      src: trades,
      alt: `P√°gina do projeto mostrando os bot√µes de a√ß√£o para cortar e vender madeira, cada um com seu nome, √≠cone e trocas associadas. A troca de cortar madeira √© de +1 üå≥ Madeira, e a troca de vender madeira √© de -1 üå≥ Madeira e +1 ü™ô Moeda.`,
    },
  ]}
/>

### Recursos

Agora, vamos adicionar dois novos recursos: casa e trabalhador.

1. Edite a enumera√ß√£o `ResourceType` no arquivo `types.ts` para incluir os novos recursos `house` e `worker`.

```ts
/* types.ts */

export enum ResourceType {
  wood = "wood",
  coin = "coin",
  house = "house",
  worker = "worker",
}
```

2. Adicione os objetos `house` e `worker` ao estado inicial de recursos no componente `App`.

```tsx
/* App.tsx */

const [resources, setResources] = useState<Resources>({
  wood: {
    name: "Madeira",
    icon: "üå≥",
    amount: 0,
  },
  coin: {
    name: "Moeda",
    icon: "ü™ô",
    amount: 0,
  },
  house: {
    name: "Casa",
    icon: "üè†",
    amount: 0,
  },
  worker: {
    name: "Trabalhador",
    icon: "üë∑",
    amount: 0,
  },
});
```

3. Edite o componente `ResourcesContainer` para exibir os novos recursos dinamicamente.

```tsx
/* ResourcesContainer.tsx */

return (
  <section className={styles.container}>
    <div className={styles.group}>
      {Object.entries(resources).map(([resourceType, resource]) => (
        <ResourceDisplay key={resourceType} resource={resource} />
      ))}
    </div>
  </section>
);
```

<Aside type="note">
  Quando mapeamos um dado para uma lista de componentes, √© importante definir
  uma chave √∫nica para cada componente. Isso ajuda o React a identificar quais
  componentes foram alterados, adicionados ou removidos.
</Aside>

O resultado final deve ser como o seguinte:

<Figure
  caption="Recursos Madeira, Moeda, Casa e Trabalhador."
  images={[
    {
      src: newResources,
      alt: `P√°gina do projeto mostrando os recursos "Madeira", "Moeda", "Casa" e "Trabalhador", cada um com seu nome, √≠cone e quantidade. Abaixo, h√° bot√µes de a√ß√£o para cortar e vender madeira.`,
    },
  ]}
/>

### A√ß√µes

Vamos adicionar duas novas a√ß√µes: construir casa e contratar trabalhador.
A casa custa madeira e moedas.
J√° o trabalhador precisa do sal√°rio pago em moedas e de uma casa para morar.

1. Edite a enumera√ß√£o `ActionType` no arquivo `types.ts` para incluir as novas a√ß√µes.

```ts
/* types.ts */

export enum ActionType {
  chopWood = "chopWood",
  sellWood = "sellWood",
  buildHouse = "buildHouse",
  hireWorker = "hireWorker",
}
```

2. Adicione os objetos `buildHouse` e `hireWorker` √† constante de a√ß√µes no componente `ActionsContainer`.

```tsx
/* ActionsContainer.tsx */

const actions: Actions = {
  chopWood: {
    name: "Cortar Madeira",
    icon: "ü™ì",
    trades: [{ resourceType: ResourceType.wood, amount: +1 }],
  },
  sellWood: {
    name: "Vender Madeira",
    icon: "üí∞",
    trades: [
      { resourceType: ResourceType.wood, amount: -1 },
      { resourceType: ResourceType.coin, amount: +1 },
    ],
  },
  buildHouse: {
    name: "Construir Casa",
    icon: "üõ†Ô∏è",
    trades: [
      { resourceType: ResourceType.wood, amount: -5 },
      { resourceType: ResourceType.coin, amount: -5 },
      { resourceType: ResourceType.house, amount: +1 },
    ],
  },
  hireWorker: {
    name: "Contratar Trabalhador",
    icon: "üßæ",
    trades: [
      { resourceType: ResourceType.coin, amount: -10 },
      { resourceType: ResourceType.house, amount: -1 },
      { resourceType: ResourceType.worker, amount: +1 },
    ],
  },
};
```

3. Atualize as chamadas do componente `ActionButton` para que elas passem as novas a√ß√µes.

```tsx
/* ActionsContainer.tsx */

return (
  <section className={styles.container}>
    <div className={styles.group}>
      {Object.entries(actions).map(([actionType, action]) => (
        <ActionButton
          key={actionType}
          action={action}
          resources={resources}
          setResources={setResources}
        />
      ))}
    </div>
  </section>
);
```

O resultado final deve ser como o seguinte:

<Figure
  caption="Bot√µes de a√ß√£o para cortar madeira, vender madeira, construir casa e contratar trabalhador."
  images={[
    {
      src: newActions,
      alt: `P√°gina do projeto mostrando os recursos "Madeira", "Moeda", "Casa" e "Trabalhador", cada um com seu nome, √≠cone e quantidade. Abaixo, h√° os seguintes bot√µes de a√ß√£o: "Cortar Madeira", "Vender Madeira", "Construir Casa" e "Contratar Trabalhador", cada um com seu nome, √≠cone e trocas associadas.`,
    },
  ]}
/>
